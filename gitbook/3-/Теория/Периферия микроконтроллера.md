---
занятие:
  - "[[Как работать с периферией микроконтроллера]]"
дата: 2026-02-17
tags:
  - занятие3
  - теория
---

Мы уже рассматривали периферию микроконтроллера как часть [[Устройство микроконтроллера#Периферия|устройства микроконтроллера]], теперь давайте разберёмся подробнее, что мы называем периферией и какой она бывает. Ведь чтобы осознанно работать с периферией, нужно понимать, что мы под ней подразумеваем и как она устроена.

## Определение

В прошлый раз мы дали конкретное определение периферии внутри микроконтроллера, но сейчас необходимо расширить понимание периферии. Если обратиться к самому слову «периферия», то с греческого это «окружность». У окружности обычно есть центр, и по большей части то, что считается периферией, определяется тем, что находится в центре. 

Если мы говорим про периферию персонального компьютера, то в центре у нас ПК, а окружают его принтеры, мониторы, мыши, клавиатуры. У всех них есть одно общее свойство, они должны как-то подключаться к центру. Для разных устройств есть разные интерфейсы подключения: USB, HDMI, DisplayPort и т.д.

Теперь вернёмся к микроконтроллеру. Здесь у нас будет несколько периферий, в зависимости от того, что будет располагаться в центре.

Определение, данное на первом занятии, описывает набор аппаратных устройств вокруг процессорных ядер. Интерфейс взаимодействия: транзакции на шине памяти. Мы предлагаем называть такую периферию — **внутренней периферией микроконтроллера**. Именно об этой периферии пойдёт речь в этом занятии.

Стоит также упомянуть, что мы будем работать с набором аппаратных устройств, в центре которых находится сам микроконтроллер. Интерфейсами взаимодействия с такой периферией служат различные протоколы: SPI, I2C, UART и т.д. Это могут быть датчики, моторы, внешняя память и т.д. Такую периферию мы будем называть **внешней периферией микроконтроллера**. Об этой периферии мы поговорим на следующем занятии. Процессор может взаимодействовать с внешней периферией исключительно через внутреннюю.

## Типы внутренней периферии

### Периферия ввода/вывода

К периферии ввода/вывода можно отнести любые модули, которые позволяют получать или передавать информацию внешним устройствам. 

Так, например, **GPIO** (*General Purpose Input/Output*, универсальный ввод-вывод) может быть подключён к кнопке или светодиоду, таким образом мы можем обмениваться информацией с человеком. Кроме того, мы можем не только взаимодействовать с пинами GPIO из кода — другие модули ввода/вывода тоже связаны с ним, поскольку имеют внешние выводы, а их настройка выполняется через GPIO. 

Модуль **АЦП** (аналого-цифровой преобразователь) может быть подключён к аналоговым датчикам, а значит мы можем получать сигнал из некоторой физической системы (давление, температура и т.д.). АЦП может создавать достаточно большие объёмы данных в зависимости от частоты дискретизации. 

Модули протоколов **SPI, I2C, UART, USB** служат для обмена данными с цифровыми устройствами: цифровыми датчиками, **ЦАП** (цифро-аналоговый преобразователь) и АЦП, другими микроконтроллерами и другой внешней периферией. Они могут как генерировать много данных, так и потреблять их — например, при формировании сигнала для ЦАП (гармонический сигнал с частотой дискретизации 1 МГц).

### Периферия памяти

*Во-первых*, это аппаратные модули, которые расширяют объём памяти, доступный процессорным ядрам. Например, это модуль XIP, который даёт процессорному ядру доступ к внешней энергонезависимой памяти с прошивкой. В целом, блоки SRAM тоже можно считать периферийным, но они слишком сильно встроены в систему и не подлежат изменению, поэтому сложно называть их таковыми.

*Во-вторых*, это модули, способные выполнять операции с памятью. Особым модулем периферии памяти в любом микроконтроллере является модуль DMA. Чтобы понять, зачем он нужен, давайте представим себе такую задачу. 

Пусть АЦП работает с частотой дискретизации 1 Мвыб/с и пишет отсчёты (по 16 бит каждый) в фиксированный буфер `adc_buffer[1024]` — аппаратно зашитый адрес назначения. За одну секунду заполняется 1 000 000 / 1024 ≈ 977 таких буферов, то есть копировать 1024×2 = 2048 байт нужно примерно каждую миллисекунду, иначе новые отсчёты перезапишут старые. Если это копирование выполняет процессор RP2040 (ядро Cortex-M0+ на 133 МГц), то один перенос 2048 байт словами по 32 бита — это порядка 512 загрузок и 512 сохранений плюс цикл цикла, то есть примерно 3000–3500 тактов. При 133 МГц одно копирование занимает около 23–26 мкс. За секунду получается 977 копирований × ~25 мкс ≈ 24 мс — то есть около **2,4% времени ядра** уходит только на перенос данных из буфера в буфер, без какой-либо обработки.

Такая задача в микроконтроллере является типовой, именно поэтому почти в каждом микроконтроллере существует аппаратный модуль, который способен заниматься переносом данных из одних областей в другие.

>[!NOTE] Определение 
>**DMA** (*Direct Memory Access*, прямой доступ к памяти) — аппаратный модуль, подключённый к системной шине и способный выполнять операции чтения и записи вместо процессора.

Обычно он поддерживает несколько режимов:
- Из периферии в память
- Из памяти в периферию
- Из памяти в память
Таким образом, этот модуль освобождает процессор от долгих операций копирования и позволяет использовать освободившееся время для более важных задач.

### Периферия времени

Мы уже говорили о том, как работает время в микроконтроллере на [[Время внутри микроконтроллера|предыдущем занятии]]. Здесь лишь дополнительно отметим, что все эти функции исполняются отдельными периферийными модулями, каждый из которых имеет свои настройки.

### Периферия вычислительная

В RP2040 нет таких периферийных модулей, но мы не можем их не упомянуть. Некоторые вычислительные задачи достаточно сложны для процессора, по большей части потому, что он может выполнять лишь одну операцию за раз. Поэтому в некоторых микроконтроллерах встраивают модули, аппаратная реализация которых позволяет эффективнее выполнять определённые вычислительные операции. Например, если нужно выполнить шифрование блока данных или подсчитать его контрольную сумму.

| **[[Архитектура ВПО\|Предыдущий раздел]]** | [[Как работать с периферией микроконтроллера\|К занятию]] | **[[Регистры периферии\|Следующий раздел]]** |
| ------------------------------------------ | --------------------------------------------------------- | -------------------------------------------- |
