---
тема: Измерительный прибор
автор: Егор Анатольевич Денисов
дата: 2026-02-17
---

# Результат

- [ ] В модуль `adc-task` добавлена функция телеметрирования измерений. Каждое измерение содержит три значения:
    - uptime, время в мс с момента запкуска МК
	- voltage, напряжение на ножке, измеренное АЦП
    - temperature, температура RP2040
- [ ] В API устройства добавлена функция включения телеметрии `tm_start`
- [ ] В API устройства добавлена функция выключения телеметрии `tm_stop`
- [ ] Прошивка скомпилирована, запущена, при вызове команды `tm_start` в COM-порт регулярно отправляются измерения. При вызове `tm_stop` измерения останавливаются.
- [ ] Проект `03-adc` закоммичен в ваш репозиторий GitHub

# Инструкция

> [!INFO] Подсказка
> Действия аналогичные последующим пунктам вы делали в `led-task`

1. Создать тип enum с состояниями `IDLE` и `RUN` в `adc-task.h`:

``` c
typedef enum
{
	ADC_TASK_STATE_IDLE = 0,
	ADC_TASK_STATE_RUN = 1,
} adc_task_state_t;
```

2. Создать прототип функции обработчика `adc_task_handle`

3. Создать прототип функции для смены состояния `adc_task_set_state`

4. В `adc_task.c` создать глобальную переменную с состоянием `adc_state`, значение по умолчанию IDLE, создать переменную типа `uint64_t` для хранения метки времени

5. Создайте переменную `ADC_TASK_MEAS_PERIOD_US` для хранения периода измерений, значение по умолчанию 100_000 мкс

6. Написать имплементацию функции `adc_task_set_state`, изменяющую состояние модуля `adc-task`

7. В `adc-task.c` написать имплементацию функции `adc_task_handle`, которая должна в состоянии `RUN` с периодом `ADC_TASK_MEAS_PERIOD_US` измерять напряжение и температуру

8. Вывести измеренные напряжение и температуру в последовательный порт в следующем формате:

``` c
printf("%f %f\n", voltage_V, temp_C);
```

9. В API устройства добавить команду `tm_start`, которая будет запускать измерения, т.е. переводить `adc-task` в состояние `RUN`

10. В API устройства добавить команду `tm_stop`, которая будет останавливать измерения, т.е. переводить `adc-task` в состояние `IDLE`

11. Cкомпилировать прошивку, загрузить в RP2040, проверить работоспособность. На вызов команды `tm_start`, RP2040 должен непрерывно отправлять в COM-порт измеренное напряжение на выводе GPIO 26 и собственную температуру:

![[Pasted image 20260219022754.png]]

12. При вызове команды `tm_stop` телеметрия должна останавливаться:

![[Pasted image 20260219023014.png]]

13. Сделать `commit` и `push` проекта `03-adc`
