---
тема: Измерительный прибор
автор: Егор Анатольевич Денисов
дата: 2026-02-17
---

# Результат

- [ ] Создана копия проекта `02-control`под названием `03-adc`
- [ ] В прошивку добавлен модуль `adc-task`
- [ ] В модуле `adc-task` реализована инициализация АЦП
- [ ] В модуле `adc-task` реализована функция измерения напряжения
- [ ] В API устройства добавлена команда измерения напряжения `get_adc`
- [ ] Прошивка скомпилирована, запущена, при вызове команды `get_adc` в COM-порт выводится значение напряжения

# Инструкция

1. Создать копию проекта `02-control` под названием `03-adc`. Весь код проекта оставить, изменить только название;

2. Создать в проекте модуль `adc-task`

> [!INFO] Напоминание
> Для создания нового модуля вам нужно:
> - создать папку `adc-task`
> - создать в ней файлы `adc-task.h` и `adc-task.c`
> - добавить в `CMakeLists.txt` файл `adc-task/adc-task.c`

3. Добавить в библиотеки на которые ссылается код библиотеку по рабоие с adc:
``` Cmake
target_link_libraries(${PROJECT_NAME}
    pico_stdlib
    hardware_adc
)
```
3. Создать прототип функции инициализации модуля `adc-task` в файле `adc-task.h`

4. В `adc-task.c` добавить включение заголовочного файла библиотеки `adc`:

``` c
#include "hardware/adc.h"
```

5. В `adc-task.c` добавить включение стандартного заголовочного файла библиотеки ввода-вывода и заголовочного файла стандартной библиотеки pico

6. В `adc-task.c` создать константы с номером GPIO ножки и номером канала АЦП, который мы будем использовать. Ножка номер 26, канал АЦП номер 0

7. Создать имплементацию функции инициализации в `adc-task.c`, содержащую следующие действия:
	- инициализировать периферийный модуль АЦП:

	``` c
	adc_init();
	```

	- инициализировать GPIO вывод на работу с АЦП:

	``` c
	adc_gpio_init( номер GPIO ножки );
	```

8. Создать прототип функции измерения напряжения в файле `adc-task.h`. Функция должна возвращать тип `float`

9. Создать имплементацию функции измерения напряжения в `adc-task.c`, содержащую следующие действия:

	- выбрать канал АЦП для измерения:

	``` c
	adc_select_input( номер канала );
	```

	- запустить измерение и считать значение:

	``` c
	uint16_t voltage_counts = adc_read();
	```

	- преобразовать значение в отсчетах (`uint16_t voltage_counts`) в значение в вольтах (`float voltage_V`) и вернуть из функции значение в вольтах

> [!INFO] Подсказка
> - Опорное напряжение АЦП в RP2040 3.3 В;
> - АЦП в RP2040 имеет разрядность 12 бит.

10. В `main.c` инициализировать модуль `adc-task`;

11. В API устройства добавить команду с названием `get_adc`. В ее callback вызвать функцию измерения напряжения, вывести в терминал значение:

``` c
printf("%f\n", voltage_V);
```

> [!ATTENTION] Обратите внимание!
> Оставьте этот вывод именно в таком формате, чтобы Python скрипт, который мы напишем позже, корректно обрабатывал вывод напряжения.

11. скомпилировать прошивку, загрузить в RP2040, проверить работоспособность. На вызов команды `get_adc`, RP2040 должен возвращать в COM-порт измеренное напряжение на выводе GPIO 26.