---
тема: Как начать работать с микроконтроллерами
автор: Егор Анатольевич Денисов
дата: 2026-01-22
tags:
  - занятие1
  - практика
---

# Результат

- [ ] Создана папка проекта `01-blink` в корне репозитория `mcu`
- [ ] В проект скопирован файл `pico_sdk_import.cmake`
- [ ] В проект скопирован файл `memmap_rp2040.ld`
- [ ] Создан файл `main.c` 
- [ ] В файле `main.c` написан код, мигающий светодиодом на ножке 25
- [ ] Создан файл `CMakeLists.txt`
- [ ] В файле `CMakeLists.txt` написан скрипт сборки проекта
- [ ] Расположение файлов соответствует приведенному в инструкции

# Инструкция

1. Создать папку с первой прошивкой, ее задача будет помигать светодиодом, поэтому называем ее `01-blink`. Последняя команда откроет эту папку в VSCode;

``` bash
cd Repositories/pico/mcu
mkdir 01-blink
cd 01-blink
code .
```

> [!INFO] Обратите внимание
>  Команды выше эквивалентны тем, что мы привыкли делать кликая мышкой: открыть папку, создать папку, открыть приложение. Однако, в отличии от кликов мышкой, работу с компьютером через терминал легко автоматизировать.

2. Скопировать файл `pico_sdk_import.cmake` из 
   `pico/pico-sdk/external/pico_sdk_import.cmake`;

> [!INFO] Справка
>  `pico_sdk_import.cmake` - это вспомогательный CMake скрипт, который упрощает подключение Pico SDK (комплекта для разработки под Raspberry Pi Pico) к вашему проекту на C/C++.

3. Скопировать файл `pico-sdk/src/rp2_common/pico_crt0/rp2040/memmap_default.ld` в папку проекта и меняем его имя на `memmap_rp2040.ld`;

> [!INFO] Справка
>  `memmap_rp2040.ld` - это [[скрипт компоновщика]] (linker script), отвечает сборку фрагментов скомпилированного кода в единое целое и за разметку FALSH и RAM памяти микроконтоллера

4. Создать файл с исходным кодом с именем `main.c`. Написать в этот файл минимально рабочий пример кода, который мигает светодиодом. Первым делом, в файл нужно добавить включение заголовочных файлов двух библиотек из pico-sdk. В `01-blink` нам нужно добавить стандартную библиотекe для функции сна:

``` c
#include "pico/stdlib.h"
```

5. Добавить библиотеку для взаимодействия с GPIO:

``` c
#include "hardware/gpio.h"
```

6. Создать константу с номеров GPIO вывода, к которому подключен светодиод. На `pi-pico` это ножка 25:

``` c
const uint LED_PIN = 25;
```

7. Создать точку входа в программу - функцию `main`:

``` c
int main()
{
// весь следующий код пишем тут
}
```

8.  Инициализировать нужный нам GPIO вывод в начале функции `main`:

``` c
gpio_init(LED_PIN);
```

9. Настроить GPIO вывод как выход:

``` c
gpio_set_dir(LED_PIN, GPIO_OUT);
```

10. Затем необходимо создать бесконечный цикл `while (1)`:

``` c
while (1)
{
// код мигания пишем здесь
}
```

> [!NOTE] Задумайтесь
> 
>  В микроконтроллере нет операционной системы, которая запускает вашу программу и нет никого, кто примет управление, если вы выйдете из функции `main`. В микроконтроллере функция `main` стартует сразу после подачи питания на микроконтроллер, а если вы из нее вышли, то микроконтроллер больше ничего не сможет делать. Поэтому, в конце функции `main` создается бесконечный цикл, в котором программа останется пока вы не снимете питание с микроконтроллера.

11. Написать логику мигания светодиодом внутри бесконечного цикла:

``` c
gpio_put(LED_PIN, 1);
sleep_ms(250);
gpio_put(LED_PIN, 0);
sleep_ms(1000);
```

На этом работа с файлом `main.c` закончена. Поздравляю, вы написали прошивку, мигающую светодиодом!

12. Создать файл со скриптом сборки нашего проекта `CMakeLists.txt`. Написать в этот файл скрипт для сборки прошивки под RP2040

``` cmake

# Требуем минимальную версию cmake - типовая строчка для любого CMakeLists.txt
cmake_minimum_required(VERSION 3.15)

# Задаем параметр с используемой платой и микроконтроллером для Pico SDK - специфика сборки под Pico
set(PICO_BOARD pico)
set(PICO_PLATFORM rp2040)

# Добавляем файл, автоматически подтягивающий Pico SDK в наш проект - специфика сборки под Pico
include(pico_sdk_import.cmake)

# Создаем проект. Аргументом указывается имя проекта - типовая строчка для любого CMakeLists.txt
project(01_blink)

# Вызываем функцию инициализации Pico SDK - специфика сборки под Pico
pico_sdk_init()

# Добавляем в проект файлы с исходным кодом - типовая строчка для любого CMakeLists.txt
add_executable(01_blink
	${CMAKE_CURRENT_SOURCE_DIR}/main.c
)

# Указываем на какие библиотеки ссылается наш код - типовая строчка для любого CMakeLists.txt
target_link_libraries(01_blink
	pico_stdlib
)

# Указываем файл, в котором находится линкер скрипт - специфика сборки под МК
pico_set_linker_script(01_blink ${CMAKE_CURRENT_SOURCE_DIR}/memmap_rp2040.ld)

# Добавляем задачи генерации бинарника в разных форматах - специфика сборки под Pico
pico_add_extra_outputs(01_blink)
```

13. Проверить, что у вас получилась структура файлов, как в схеме ниже, всего 4 файла:

```
Repositories
|-- pico
	|-- pico-sdk
	|-- mcu
		|-- 01-blink
			|-- main.c
			|-- CMakeLists.txt
			|-- memmap_rp2040.ld
		    |-- pico_sdk_import.cmake
```

> [!NOTE] Обратите внимание
> Именно этих четырех файлов достаточно для сборки проекта и получения бинарного файла прошивки. Только эти четыре файла нужно коммитить в репозиторий.

