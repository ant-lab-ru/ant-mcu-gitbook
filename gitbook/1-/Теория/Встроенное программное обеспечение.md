---
занятие:
  - "[[Как начать работать с микроконтроллерами]]"
дата: 2026-01-25
tags:
  - занятие1
  - теория
---
Мы уже поняли, как устроен микроконтроллер, как устроена его память и где хранится его программа, а значит самое время разобраться, что из себя представляет эта программа. В этот раз мы начнём с определения.

## Определение

Как и с многими инженерными терминами, возникновение этого термина было достаточно хаотичным и рождалось прямо в процессе развития. На заре развития вычислительной техники такую программу называли **прошивкой** из-за способа записи бит программы на элемент памяти первых ЭВМ. По сей день этот термин является базовым разговорным термином для описания программы микроконтроллера. В более формальном контексте (документация, отчёты, учебные материалы) обычно используют термин **встроенное программное обеспечение**.

>[!NOTE] Определение
> **Встроенное программное обеспечение** (*ВПО, англ. Emebedded Software*) — программа (или набор программ) необходимый встраиваемой системе для выполнения её специализированных функций.

В английском языке также широко используется термин **firmware** (сокращённо **fw**) — исторически он возник как “нечто среднее” между *software* и *hardware* и часто употребляется как близкий по смыслу синоним “прошивки”. Мы также иногда будем использовать термин **программа микроконтроллера** ради лучшей читаемости текста.

##  Три “формы” ВПО

Часто вы можете прочитать термин **ВПО** в разных контекстах, так происходит потому что это общий термин, который может обозначать сразу несколько сущностей, зависящих от этапа разработки. Ниже в таблице мы попытались разграничить эти этапы и дать вам способы называть ВПО в разных формах.

| #   | Форма ВПО                                                               | Где хранится                         | Как называть                                               |
| --- | ----------------------------------------------------------------------- | ------------------------------------ | ---------------------------------------------------------- |
| 1   | все файлы проекта, необходимые для сборки программы<br>микроконтроллера | проект в репозитории                 | исходный код ВПО; проект ВПО; исходники прошивки           |
| 2   | результат сборки <br>на компьютере<br>(.elf, .bin, .hex, .uf2).         | папка build внутри проекта           | файл прошивки; бинарник прошивки;<br>файл-образ ВПО        |
| 3   | байты файла прошлого этапа записанные в память (Flash/внешняя QSPI)     | на микроконтроллере/плате (во Flash) | прошивка в памяти; образ прошивки во Flash; записанное ВПО |

## Отличия ВПО от программы на ПК

После того как мы поняли, каким словом называть программу микроконтроллера, давайте сравним её с обычном программой на компьютере и поймём, чем они отличаются, тем самым разберемся, в чем основные задачи ВПО.

**Во-первых**, вспомним, как выглядит программа для пользователя на ПК. Обычно это исполняемый файл (exe-файл на Windows). Аналогом такого файла для микроконтроллера является файл в энергонезависимой памяти.

**Во-вторых**, вспомним, как мы запускаем программу на ПК. Мы кликаем два раза на файл и он начинает выполнять свои функции. В микроконтроллере ВПО запускается сразу со стартом прошивки, после подачи питания.

**В-третьих**, программа на ПК работает в контексте операционной системы компьютера. Программы для Linux, будут отличаться от программ на Windows. Если программа хочет получить доступ к аппаратным средствам, она должна пользоваться драйверами операционной системы. Программа микроконтроллера имеет полный доступ к аппаратным устройствам и сама реализует драйверы этих устройств.

На самом деле, уже сейчас можно сказать, что у **ВПО** больше общего с **операционными системами**, чем с обычными программами: оно выполняет инициализацию системы, обеспечивает работу с аппаратными устройствами, содержит в себе “драйверы” для периферии и логику управления устройством в реальном времени, управляет временными ресурсами процессора.

## Задачи ВПО

1. Инициализация микроконтроллера
	- настройка тактирования, памяти, стеков, таблиц прерываний
	- перевод периферии в известное начальное состояние

2. Настройка и управление периферией
	- конфигурация GPIO, таймеров, PWM, ADC
	- работа с интерфейсами связи (UART/SPI/I2C и др.)

3. Обработка событий в реальном времени
	- обработка прерываний (таймер, приём данных, завершение измерения)
	- выполнение реакции в заданные временные ограничения

4. Сбор и обработка данных
	- чтение датчиков, фильтрация, калибровка
	- расчёты и преобразования для принятия решений

5. Управление исполнительными механизмами
	- формирование управляющих сигналов
	- поддержание режимов работы (стабилизация, регулирование)

6. Обмен данными с внешним миром
	- протоколы, команды, телеметрия
	- интерфейс “прибор ↔ пользователь/другой прибор”

7. Надёжность и самоконтроль
	- watchdog, обработка ошибок, диагностика, логирование
	- безопасные режимы (fail-safe), восстановление после сбоев
## Структура исходного кода ВПО

Исходный код ВПО условно можно на разделить на следующие части:

1. **Функции SDK** — готовые библиотеки кода, поставляемые производителем микроконтроллера, необходимые для инициализации процессорного ядра и периферии.
2. **Инициализация** — код выполняющий настройку периферии при старте
3. **Бесконечный цикл** — код основной логики программы микроконтроллера
4. **Обработчики прерываний** — код реакций на события прерываний (опционально)

**Пример структуры (псевдокод):**
```c
#include "pico/stdlib.h"  // 1. Подключение функций SDK

int main() {
    // 2. Инициализация
    gpio_init(25);              // Инициализация GPIO
    gpio_set_dir(25, OUTPUT);   // Настройка как выход
    
    // 3. Бесконечный цикл
    while (true) {
        gpio_put(25, HIGH);     // Включить LED
        sleep_ms(500);          // Задержка 500 мс
        gpio_put(25, LOW);      // Выключить LED
        sleep_ms(500);          // Задержка 500 мс
    }
    
    // Сюда программа никогда не дойдёт
    return 0;
}
```

##  Структура образа ВПО

Структуру образа ВПО сложно осознать без понимания того, как запускается образ ВПО процессором, поэтому пока мы просто приведем списком, что может быть в образе ВПО, а подробнее поговорим об этом позже.

1. **Указатель на начало стека**
2. **Таблица векторов**
	- набор адресов обработчиков исключений/прерываний
	- содержит начальное значение указателя стека и адрес точки входа (Reset handler)
3. **Код программы (.text)**
	- инструкции исходного кода ВПО
	- здесь `main()`
4. **Константы и неизменяемые данные (.rodata)**
	- строковые литералы, таблицы, неизменяемые коэффициенты
5. **Инициализационные данные для RAM (.data)**
	- значения глобальных/статических переменных, которые должны стартовать не с нуля
	- хранятся во Flash как “образ”, но при старте копируются в RAM
6. **Секция нулевой инициализации (.bss)**
	- секция для статических данных, инициализируемых нулём согласно правилам языка и стартового кода
	- в образе обычно хранится только “размер/границы”, а в RAM она обнуляется при старте
7. **Метаданные / служебные секции (опционально)**
	- таблицы символов/отладочная информация (часто только в .elf, но не в .bin/.uf2)
	- идентификатор версии, CRC/подпись, настройки загрузчика

>[!NOTE] Дополнительно
>[[Структура образа ВПО RP2040]]

| **[[Устройство микроконтроллера\|Предыдущий раздел]]** | [[Как начать работать с микроконтроллерами\|К занятию]] | **[[От исходного кода ВПО до прошивки\|Следующий раздел]]** |
| ------------------------------------------------------ | ------------------------------------------------------- | ----------------------------------------- |
