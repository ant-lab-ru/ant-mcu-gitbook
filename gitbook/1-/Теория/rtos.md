**RTOS (Real-Time Operating System) — Операционная система реального времени**

**Простыми словами:** Это специальная операционная система, которая гарантирует выполнение задач **в строго определённые сроки**. Её главная цель — не скорость, а **предсказуемость** и надёжность реакции на события.

---

### Ключевая идея

В обычной ОС (Windows, Linux) мы хотим **сделать много всего** (запустить браузер, музыку, игру). В RTOS мы хотим, чтобы **критичные задачи выполнялись точно вовремя**. Поздний результат = ошибочный результат.

---

### Характеристики RTOS

1. **Детерминированность:** Время отклика системы на событие можно рассчитать и гарантировать.
    
2. **Приоритетная многозадачность:** Задачи с более высоким приоритетом всегда вытесняют задачи с низким приоритетом.
    
3. **Маленький размер:** Ядро RTOS занимает единицы-десятки килобайт.
    
4. **Эффективные механизмы синхронизации:** Семафоры, мьютексы, очереди сообщений, события — для корректной работы параллельных задач.
    

---

### Виды RTOS по «жёсткости»

|Тип|Описание|Пример|
|---|---|---|
|**Жёсткого реального времени (Hard RTOS)**|**Нарушение сроков недопустимо** и ведёт к катастрофическому отказу системы.|Авионика (система управления двигателем), ABS в автомобиле, кардиостимулятор. Если сигнал на закрытие клапана придёт позже — двигатель разрушится.|
|**Мягкого реального времени (Soft RTOS)**|**Нарушение сроков нежелательно**, но система остаётся работоспособной. Качество обслуживания падает.|Потоковое видео (задержка вызовет буферизацию), интерактивные сенсорные панели. Пропуск кадра — неприятно, но не смертельно.|
|**Нереального времени (General-Purpose OS)**|**Сроки не гарантируются.** Система старается работать быстро, но без гарантий.|Windows, Linux (десктоп). Зависание курсора — досадно, но перезагрузка решит проблему.|

---

### Основные компоненты и концепции RTOS

**1. Задача (Task) / Поток (Thread)**  
Независимая единица выполнения. Каждая задача имеет:

- Свой контекст (состояние регистров, стек).
    
- Приоритет.
    
- Функцию-тело (то, что она выполняет).
    

**2. Планировщик (Scheduler)**  
«Диспетчер» ядра RTOS. Решает, **какая задача будет выполняться в данный момент**. Основан на приоритетах.

**3. Механизмы межзадачного взаимодействия (IPC)**  
Позволяют задачам общаться и синхронизироваться:

- **Очереди сообщений:** Передача данных между задачами.
    
- **Семафоры:** Синхронизация и управление доступом к ресурсам (например, к периферии).
    
- **Мьютексы:** Взаимное исключение для защиты общих данных (критических секций).
    
- **События:** Уведомление о наступлении какого-либо события.
    

**4. Прерывания (ISR)**  
Обработка аппаратных событий. В RTOS ISR должны быть **очень короткими**. Обычно ISR только отправляет сигнал (например, семафор) задаче, а основную обработку делает уже высокоприоритетная задача.

---

### Как это работает на практике?

Рассмотрим систему умного дома с RTOS.

- **Задача 1 (Приоритет HIGH):** Чтение датчика задымления. **Должна сработать немедленно**, если есть дым, чтобы включить сирену.
    
- **Задача 2 (Приоритет MEDIUM):** Отправка данных телеметрии (температуры) на сервер раз в минуту.
    
- **Задача 3 (Приоритет LOW):** Мигание светодиодом «всё OK» раз в 2 секунды.
    

**Сценарий:** Во время мигания светодиодом срабатывает датчик дыма.

1. Прерывание от датчика немедленно запускает **ISR**.
    
2. ISR отдаёт семафор **Задаче 1**.
    
3. **Планировщик** видит, что у Задачи 1 приоритет **выше**, чем у текущей Задачи 3.
    
4. Он мгновенно **вытесняет** Задачу 3, сохраняет её контекст и запускает **Задачу 1**.
    
5. Задача 1 включает сирену и отправляет тревожное сообщение.
    
6. Только после этого может продолжиться выполнение Задачи 3 (мигание) или Задачи 2 (отправка данных).