---
тема: Как работать с внешней периферией
автор: Егор Анатольевич Денисов
дата: 2026-02-25
---

# Результат

- [ ] в драйвере BME280 написана функция записи в регистр
- [ ] в API устройства добавлена функция записи в регистр BME280
- [ ] после записи `0b00100101` в регистр `ctrl_meas` в регистрах данных BME280 появляются измерения

![[Pasted image 20260225174059.png]]

# Инструкция

1. Добавить в заголовочный файл библиотеки драйвера BME280 прототип функции записи в регистр BME280:

``` c
void bme280_write_reg(uint8_t reg_address, uint8_t value);
```

2. Реализовать функцию записи в регистр. Для этого необходимо отправить байт адреса регистра и после него байт значения регистра. Создайте такой массив. Отправьте его в I2C

``` c
uint8_t data[2] = {reg_address, value};
```

3. Добавить в API устройства функцию записи в регистр `write_reg`. Первый аргумент - адрес регистра. Второй аргумент - значение для записи в регистр. Не забудьте добавить проверки на адрес и значение.

4. скомпилировать прошивку, загрузить в RP2040, проверить работоспособность

5. Считать все основные регистры BME280

``` 
read_regs f2 d
```

все регистры должны быть `0x00` или  `0x80`.

6. запустите измерение, вписав значение `0x25` в регистр `0xF4`:

```
write_reg f4 25
```

7. Заново считать все основные регистры BME280. По адресам `0xF4 0xF7 0xFB` должны быть не нули. В этих регистрах как раз и лежат ваши измерения. Их можно перевести в температуру и давление на калькуляторе. Однако далее мы это сделаем в самой прошивке.

