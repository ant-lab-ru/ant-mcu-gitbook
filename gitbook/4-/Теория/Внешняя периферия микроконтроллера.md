---
занятие:
  - "[[Как работать с внешней периферией]]"
дата: 2026-02-25
tags:
  - занятие4
  - теория
---

Как подключить к микроконтроллеру датчик температуры или внешнюю память? И почему нельзя просто припаять провода к любым выводам?

На прошлом занятии мы ввели понятие внешней и внутренней периферии и поняли, что взаимодействие с внешней периферией возможно только через внутреннюю периферию ввода/вывода. Также мы разобрались, что внешняя периферия необходима, когда ресурсы самого микроконтроллера не удовлетворяют поставленным задачам. Например, мы уже выяснили, что внутренний АЦП работает с частотой дискретизации 500 кГц, а значит сигналы с большей частотой необходимо оцифровывать при помощи внешнего АЦП.

Внешней периферией может быть что угодно: память (как флеш-память в Raspberry Pi Pico, подключённая через QSPI), вычислительные модули, сложные интерфейсы типа USB 3.0, Ethernet, WiFi, которые трудно разместить внутри микроконтроллера, а также аналоговые и цифровые датчики.

>[!NOTE] Определение
>**Внешняя периферия** (*англ. external peripherals*) — аппаратные устройства, соединённые с микроконтроллером при помощи физических интерфейсов обмена данными.

Всё это многообразие отражено на схеме ниже, которая собирает наши предыдущие знания о периферии и добавляет новые концепции.
![[Карта периферии.drawio.png]]

>[!ATTENTION] Внимание!
>На этой схеме GPIO и интерфейсы I2C, SPI показаны как отдельные сущности, хотя все они по факту являются портами GPIO. В данном случае разделение скорее функциональное, а не физическое.

Основная цель этой схемы — показать относительность понятия периферии на разных уровнях. Всё зависит от того, что находится в центре. Если в центре процессор, то мы говорим о **внутренней периферии микроконтроллера**. Если в центре микроконтроллер — это **внешняя периферия микроконтроллера**. Состав и способы подключения внешней периферии сильно зависят от разработчика платы. Если микроконтроллер поставляется с определённым набором функций и мы можем лишь выбрать версию микроконтроллера, то архитектура всей встраиваемой системы целиком зависит от технического задания, поставленного нам как инженерам.

## От микроконтроллера к внешней периферии

Какую бы внешнюю периферию мы ни выбрали, в любом случае возникает задача соединить её с микроконтроллером. Для этого существуют **выводы** микроконтроллера, которые также называют **пинами** (*англ. pin*). Каждый пин имеет своё назначение и может предоставлять одну или несколько функций. Ниже показана схема пинов RP2040. [[RP2040 Datasheet.pdf#page=12|Вы можете открыть её в даташите]]. Сначала разберёмся со схемой, а затем обсудим таблицы.

![[Pasted image 20260225133933.png]]

Как только вам понадобится сделать плату для встраиваемой системы с микроконтроллером, прежде всего вам пригодится эта картинка. На ней видно, что к центральному выводу обязательно подключается земля. К пинам `1, 10, 22, 33, 42` подключается питание GPIO. А пины `38, 39, 40, 41` подключены к четырём каналам внутреннего АЦП — только к ним можно подключить аналоговый датчик. Подробное описание есть в даташите в [[RP2040 Datasheet.pdf#page=12|таблице 1]] после рисунка.

Больше всего на этой схеме портов GPIO. Важно понимать, что номер пина не равен номеру порта GPIO — это видно на рисунке. Эти порты неспроста называются General Purpose (общего назначения). Они могут выполнять множество функций в зависимости от настроек модуля, управляющего GPIO внутри микроконтроллера. Порт может работать как обычная ножка, в которую мы записываем логический 0 или 1 (как мы делали со светодиодом). Но можно подключить его к внутренней периферии: SPI, I2C, UART, PWM. Тогда ножка будет управляться соответствующим модулем. Описание всех функций каждой ножки можно прочитать в [[RP2040 Datasheet.pdf#page=13|таблице 2]] и [[RP2040 Datasheet.pdf#page=14|таблице 3]].

На Raspberry Pi 4 вы работали с GPIO через библиотеку RPi.GPIO, и там каждый пин тоже имел несколько возможных функций. В микроконтроллере принцип тот же, но выбор функции пина делается через регистры или функции SDK.

>[!NOTE] Из практики
>Из таблицы видно, что не каждую ножку можно подключить к каждому модулю. Представьте, что вам нужно подключить дисплей по SPI и датчик температуры по I2C — придётся заранее проверить, какие пины поддерживают нужные интерфейсы. При разработке платы важно понимать, какие функции может выполнять тот или иной GPIO-порт, чтобы после многомесячного ожидания производства платы не обнаружить, что на нужной ножке нет SPI.

Итак, мы разобрались, как микроконтроллер соединяется с внешней периферией на уровне одной платы. Но на схеме выше можно заметить ещё один уровень — периферию, которая находится за пределами единой печатной платы.

## Внеплатная периферия микроконтроллера

Периферия может не находиться на одной плате с микроконтроллером. Такую периферию будем называть **внеплатной**. Обычно это случается, когда встраиваемая система имеет большие размеры или когда необходимо производить измерения в удалённом месте.

Например, на заводе может быть линия производства молока. По этой линии перемещаются пакеты, а множество датчиков и **актуаторов** (*исполнительных устройств*) следит за её состоянием и управляет ею. Но линия достаточно большая, и датчики разнесены — они находятся не на одной плате с микроконтроллером. В таком случае они соединяются с платой проводным или беспроводным соединением.

Иногда вынесенные датчики становятся слишком сложными, и тогда там тоже появляется свой микроконтроллер со своей периферией. Такую систему можно считать периферией лишь в логическом смысле: на ней, возможно, не происходит принятие решений, и весь алгоритм состоит лишь в том, чтобы собрать данные и передать их центральному узлу. Но по факту это полноценная встраиваемая система.

Если мы говорим о простых датчиках, то главное их отличие от внутриплатных — способ подключения. Именно способам подключения внешней периферии — интерфейсам SPI, I2C, UART — посвящена следующая статья.

| **[[Внутренняя периферия микроконтроллера\|Предыдущий раздел]]** | [[Как работать с внешней периферией\|К занятию]] | **[[Как связаться с внешней периферией\|Следующий раздел]]** |
| ---------------------------------------------------------------- | ------------------------------------------------ | ------------------------------------------------------------ |
